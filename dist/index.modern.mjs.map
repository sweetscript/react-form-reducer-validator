{"version":3,"file":"index.modern.mjs","sources":["../src/validatorjs/Resolver.ts"],"sourcesContent":["import { ValidationResolver, Errors } from 'react-form-reducer';\nimport Validator, { ErrorMessages, Rules } from 'validatorjs';\n\nexport type CustomValidationCallback = (\n  fieldValue: any,\n  args: any,\n  attribute: any,\n  data: any\n) => boolean;\nexport type CustomValidationRule = {\n  name: string;\n  callback: CustomValidationCallback;\n  message: string;\n};\n\nexport default class Resolver<IData = any> extends ValidationResolver<IData> {\n  rules?: Rules;\n  messages?: ErrorMessages;\n  customRules?: CustomValidationRule[];\n\n  constructor(\n    rules: Rules,\n    messages?: ErrorMessages,\n    customValidationRules?: CustomValidationRule[]\n  ) {\n    super();\n    this.rules = rules;\n    this.messages = messages;\n    this.customRules = [\n      {\n        name: 'required_if',\n        callback: (fieldValue, args, _, data) => {\n          const isRequired = `${data[args[0]]}` === `${args[1]}`;\n          return !isRequired || (fieldValue && fieldValue !== '');\n        },\n        message: 'The :attribute field is required'\n      }\n    ].concat(customValidationRules || []);\n\n    return this;\n  }\n\n  validate(fields: IData, fieldsToCheck?: Array<keyof IData>): true | Errors {\n    let rules: { [key: string]: unknown } = this.rules || {};\n    let validateFields: { [key: string]: unknown } = fields || {};\n    if (fieldsToCheck) {\n      validateFields = {};\n      const fieldRules: { [key: string]: unknown } = {};\n      fieldsToCheck.forEach((fieldKey) => {\n        validateFields[fieldKey as string] = fields?.[fieldKey as string];\n        if (rules[fieldKey as string]) {\n          fieldRules[fieldKey as string] = rules[fieldKey as string];\n        }\n      });\n      rules = fieldRules;\n    }\n    if (this.customRules) {\n      this.customRules.forEach((customRule) => {\n        Validator.register(\n          customRule.name,\n          (value, args, attribute) => {\n            return customRule.callback(value, args, attribute, fields);\n          },\n          customRule.message\n        );\n      });\n    }\n    const validation = new Validator(\n      validateFields,\n      rules as Rules,\n      this.messages\n    );\n    const pass = validation.passes();\n    if (pass) return true;\n    return validation.errors.all();\n  }\n}\n"],"names":["Resolver","ValidationResolver","constructor","rules","messages","customValidationRules","super","this","customRules","name","callback","fieldValue","args","_","data","message","concat","validate","fields","fieldsToCheck","validateFields","fieldRules","forEach","fieldKey","customRule","Validator","register","value","attribute","validation","passes","errors","all"],"mappings":"mFAeqB,MAAAA,UAA8BC,EAKjDC,YACEC,EACAC,EACAC,GAgBA,OAdAC,QAAQC,KATVJ,kBACAC,cAAQ,EAAAG,KACRC,iBAAW,EAQTD,KAAKJ,MAAQA,EACbI,KAAKH,SAAWA,EAChBG,KAAKC,YAAc,CACjB,CACEC,KAAM,cACNC,SAAUA,CAACC,EAAYC,EAAMC,EAAGC,MACX,GAAGA,EAAKF,EAAK,OAAa,GAAAA,EAAK,OAC3BD,GAA6B,KAAfA,EAEvCI,QAAS,qCAEXC,OAAOX,GAAyB,QAGpC,CAEAY,SAASC,EAAeC,GACtB,IAAIhB,EAAoCI,KAAKJ,OAAS,CAAA,EAClDiB,EAA6CF,GAAU,CAAA,EAC3D,GAAIC,EAAe,CACjBC,EAAiB,CAAE,EACnB,MAAMC,EAAyC,CAAE,EACjDF,EAAcG,QAASC,IACrBH,EAAeG,GAAsBL,MAAAA,OAAAA,EAAAA,EAASK,GAC1CpB,EAAMoB,KACRF,EAAWE,GAAsBpB,EAAMoB,GACxC,GAEHpB,EAAQkB,CACT,CACGd,KAAKC,aACPD,KAAKC,YAAYc,QAASE,IACxBC,EAAUC,SACRF,EAAWf,KACX,CAACkB,EAAOf,EAAMgB,IACLJ,EAAWd,SAASiB,EAAOf,EAAMgB,EAAWV,GAErDM,EAAWT,QAAO,GAIxB,MAAMc,EAAa,IAAIJ,EACrBL,EACAjB,EACAI,KAAKH,UAGP,QADayB,EAAWC,UAEjBD,EAAWE,OAAOC,KAC3B"}